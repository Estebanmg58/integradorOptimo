-- ???????????????????????????????????????????????????????????????
-- CONFIGURACIONES PREDEFINIDAS PARA DIFERENTES ESCENARIOS
-- ???????????????????????????????????????????????????????????????
-- Usa estos scripts para configurar rápidamente según tu necesidad
-- ???????????????????????????????????????????????????????????????

USE IntegradorDB;
GO

PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '    CONFIGURACIONES PREDEFINIDAS - INTEGRADOR ÓPTIMO';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 1: PRODUCCIÓN - Ejecución Diaria Nocturna
-- ???????????????????????????????????????????????????????????????

PRINT '?? ESCENARIO 1: PRODUCCIÓN - Ejecución Diaria Nocturna';
PRINT '   Descripción: Sincronización completa todos los días a las 2 AM';
PRINT '   Ideal para: Cooperativas pequeñas/medianas (~15K productos)';
PRINT '';
PRINT '-- Para aplicar esta configuración, ejecuta:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''0 2 * * *'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''500'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''2'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '-- Verificar:';
PRINT 'EXEC sp_ViewCurrentConfiguration;';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 2: PRODUCCIÓN - Sincronización Frecuente
-- ???????????????????????????????????????????????????????????????

PRINT '? ESCENARIO 2: PRODUCCIÓN - Sincronización Frecuente';
PRINT '   Descripción: Sincronización cada 4 horas (6 veces al día)';
PRINT '   Ideal para: Cooperativas grandes con alta actividad';
PRINT '';
PRINT '-- Para aplicar esta configuración, ejecuta:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''0 */4 * * *'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''500'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''0'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '-- FullLoad solo a medianoche:';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''0'';';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 3: DESARROLLO - Pruebas Rápidas
-- ???????????????????????????????????????????????????????????????

PRINT '?? ESCENARIO 3: DESARROLLO - Pruebas Rápidas';
PRINT '   Descripción: Ejecución cada 5 minutos con lotes pequeños';
PRINT '   Ideal para: Desarrollo y pruebas';
PRINT '';
PRINT '-- Para aplicar esta configuración, ejecuta:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''*/5 * * * *'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''100'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''-1'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '-- Nota: Movimientos desactivados para pruebas más rápidas';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 4: PRUEBAS DE RENDIMIENTO
-- ???????????????????????????????????????????????????????????????

PRINT '?? ESCENARIO 4: PRUEBAS DE RENDIMIENTO';
PRINT '   Descripción: Sincronizar solo Productos con TODO de una vez';
PRINT '   Ideal para: Medir performance del sistema';
PRINT '';
PRINT '-- Para aplicar esta configuración, ejecuta:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''*/10 * * * *'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''50000'';'; -- Lote grande para enviar todo
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''-1'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''false'';';
PRINT '';
PRINT '-- Nota: BatchSize alto para forzar envío completo';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 5: SINCRONIZACIÓN SOLO EN HORAS LABORALES
-- ???????????????????????????????????????????????????????????????

PRINT '? ESCENARIO 5: SINCRONIZACIÓN SOLO EN HORAS LABORALES';
PRINT '   Descripción: Cada hora de 8 AM a 6 PM, Lunes a Viernes';
PRINT '   Ideal para: Minimizar impacto en horas no laborales';
PRINT '';
PRINT '-- Para aplicar esta configuración, ejecuta:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''0 8-18 * * 1-5'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''500'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''8'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '-- Nota: Solo ejecuta Lun-Vie de 8 AM a 6 PM';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 6: MIGRACIÓN INICIAL (UNA SOLA VEZ)
-- ???????????????????????????????????????????????????????????????

PRINT '?? ESCENARIO 6: MIGRACIÓN INICIAL (UNA SOLA VEZ)';
PRINT '   Descripción: Para la primera carga completa de datos';
PRINT '   Ideal para: Puesta en marcha inicial del sistema';
PRINT '';
PRINT '-- PASO 1: Configurar para ejecución inmediata';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''*/2 * * * *'';'; -- Cada 2 minutos
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''1000'';'; -- Lotes grandes
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''-1'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '-- PASO 2: Iniciar el servicio';
PRINT '-- sc.exe start IntegradorOptimo';
PRINT '';
PRINT '-- PASO 3: Monitorear logs';
PRINT '-- Get-Content C:\IntegradorOptimo\logs\log-*.txt -Tail 50 -Wait';
PRINT '';
PRINT '-- PASO 4: Una vez completada la migración, cambiar a producción:';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''0 2 * * *'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''500'';';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 7: MANTENIMIENTO - DESHABILITAR TEMPORALMENTE
-- ???????????????????????????????????????????????????????????????

PRINT '??? ESCENARIO 7: MANTENIMIENTO - DESHABILITAR TEMPORALMENTE';
PRINT '   Descripción: Pausar sincronización sin detener el servicio';
PRINT '   Ideal para: Mantenimiento del ERP o API';
PRINT '';
PRINT '-- Para DESHABILITAR todas las entidades:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''false'';';
PRINT '';
PRINT '-- El servicio seguirá ejecutándose pero NO sincronizará nada';
PRINT '';
PRINT '-- Para REACTIVAR:';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 8: ALTA DISPONIBILIDAD - Sincronización Continua
-- ???????????????????????????????????????????????????????????????

PRINT '?? ESCENARIO 8: ALTA DISPONIBILIDAD - Sincronización Continua';
PRINT '   Descripción: Sincronización cada 15 minutos las 24 horas';
PRINT '   Ideal para: Aplicaciones críticas que requieren datos actualizados';
PRINT '';
PRINT '-- Para aplicar esta configuración, ejecuta:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''*/15 * * * *'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''500'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''2'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '-- Nota: FullLoad solo a las 2 AM';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 9: FIN DE MES - Carga Especial
-- ???????????????????????????????????????????????????????????????

PRINT '?? ESCENARIO 9: FIN DE MES - Carga Especial';
PRINT '   Descripción: Sincronización el último día de cada mes';
PRINT '   Ideal para: Cierre mensual y reportes';
PRINT '';
PRINT '-- Para aplicar esta configuración, ejecuta:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''0 23 28-31 * *'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''500'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''23'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true'';';
PRINT '';
PRINT '-- Nota: Se ejecuta del 28-31 de cada mes a las 11 PM';
PRINT '-- (cubre todos los meses sin importar cuántos días tengan)';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- ESCENARIO 10: PERSONALIZADO - Template Vacío
-- ???????????????????????????????????????????????????????????????

PRINT '?? ESCENARIO 10: PERSONALIZADO - Template Vacío';
PRINT '   Descripción: Template para crear tu propia configuración';
PRINT '';
PRINT '-- Copia este bloque y ajusta según tu necesidad:';
PRINT '';
PRINT 'EXEC sp_UpdateIntegrationSetting ''ScheduleCron'', ''TU_CRON_EXPRESSION'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''BatchSize'', ''TU_BATCH_SIZE'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''DailyTruncateHour'', ''TU_HORA'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableAsociados'', ''true/false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableProductos'', ''true/false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableMovimientos'', ''true/false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableTasas'', ''true/false'';';
PRINT 'EXEC sp_UpdateIntegrationSetting ''EnableFechaCorte'', ''true/false'';';
PRINT 'EXEC sp_ViewCurrentConfiguration;';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- TABLA RESUMEN
-- ???????????????????????????????????????????????????????????????

PRINT '???????????????????????????????????????????????????????????';
PRINT '                    TABLA RESUMEN';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';
PRINT 'Escenario                    | Cron           | BatchSize | Frecuencia';
PRINT '---------------------------- | -------------- | --------- | --------------------';
PRINT '1. Producción Nocturna       | 0 2 * * *      | 500       | Diario 2 AM';
PRINT '2. Sincronización Frecuente  | 0 */4 * * *    | 500       | Cada 4 horas';
PRINT '3. Desarrollo                | */5 * * * *    | 100       | Cada 5 minutos';
PRINT '4. Pruebas Performance       | */10 * * * *   | 50000     | Cada 10 min';
PRINT '5. Horas Laborales           | 0 8-18 * * 1-5 | 500       | Lun-Vie 8AM-6PM';
PRINT '6. Migración Inicial         | */2 * * * *    | 1000      | Cada 2 min (temporal)';
PRINT '7. Mantenimiento             | N/A            | N/A       | Todo desactivado';
PRINT '8. Alta Disponibilidad       | */15 * * * *   | 500       | Cada 15 minutos';
PRINT '9. Fin de Mes                | 0 23 28-31 * * | 500       | Último día 11 PM';
PRINT '10. Personalizado            | Custom         | Custom    | Custom';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
PRINT '';

-- ???????????????????????????????????????????????????????????????
-- NOTAS FINALES
-- ???????????????????????????????????????????????????????????????

PRINT '?? NOTAS IMPORTANTES:';
PRINT '';
PRINT '1. Después de cambiar la configuración, el servicio la';
PRINT '   aplicará en la siguiente verificación (cada minuto)';
PRINT '';
PRINT '2. Para aplicar cambios INMEDIATAMENTE:';
PRINT '   sc.exe stop IntegradorOptimo';
PRINT '   sc.exe start IntegradorOptimo';
PRINT '';
PRINT '3. Verificar siempre con:';
PRINT '   EXEC sp_ViewCurrentConfiguration;';
PRINT '';
PRINT '4. Ver historial de ejecuciones:';
PRINT '   SELECT TOP 20 * FROM vw_RecentExecutions;';
PRINT '';
PRINT '5. Validar Cron expressions en: https://crontab.guru/';
PRINT '';
PRINT '???????????????????????????????????????????????????????????';
GO
